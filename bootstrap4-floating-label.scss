/**
 * Other implementations:
 * - https://www.jquery-az.com/boots/demo.php?ex=52.0_3
 * - https://www.primefaces.org/primereact/#/inputtext
 * - https://getbootstrap.com/docs/4.1/examples/floating-labels/
 * - https://github.com/tonystar/bootstrap-float-label
 * - https://lusaxweb.github.io/vuesax/components/input.html#label-placeholder
 *   https://github.com/lusaxweb/vuesax/blob/master/src/components/vsInput/main.styl
 */

$floating-label-scale: 0.75 !default;

// calc(move label at the top of the input - 1/3 of the label text height)
// See $input-height-inner and $input-height https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_variables.scss#L445-L446
//
// Why not include the font descent (distance between the font baseline and its bounding box bottom)?
// Problem: it differs from one font to another and cannot be computed in CSS
// See [TrueType fundamentals](https://docs.microsoft.com/en-us/typography/opentype/spec/ttch01)
// See [Meaning of top, ascent, baseline, descent, bottom, and leading in Android's FontMetrics](https://stackoverflow.com/a/27631737/990356)
$label-top-position: calc(
  #{- $font-size-base * $input-line-height} + #{$input-border-width} + #{$font-size-base *
    $input-line-height * 1 / 3} / #{$floating-label-scale}
);

.form-group {
  position: relative;

  // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_reboot.scss#L313
  margin-top: $form-group-margin-bottom + $label-margin-bottom;

  // Initial state: the label is inside the input
  > input + label {
    position: absolute;

    // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_variables.scss#L241
    transition: $transition-base;

    @extend %label-inside-input;
  }

  // Initial state: hide the placeholder
  > input::placeholder {
    color: transparent;
    transition: color 0.15s linear; // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_variables.scss#L242
  }
  // Except if <label> is before <input> => not a floating label
  > label + input::placeholder {
    color: inherit;
  }

  // When the input is focused:
  > input:focus {
    // - show the placeholder
    &::placeholder {
      color: inherit;
    }

    // - move the label above the input
    + label {
      @extend %label-above-input;
    }
  }

  // Move the label above when the input contains text
  //
  // There is no CSS selector for input with a value entered by the user
  // See [Detect if an input has text in it using CSS](https://stackoverflow.com/q/16952526)
  //
  // Hack:
  // input with a placeholder not showing the placeholder => there is text from the user in it
  //
  // Edge and IE CSS parsers fail on :placeholder-shown, even inside @supports
  /*> input[placeholder]:not(:placeholder-shown) + label {
    @extend %label-above-input;
  }*/

  // With React, value attribute is present
  // - Matches <input value>
  > input[value=''] + label {
    @extend %label-inside-input;
  }
  // - Matches <input value="hello">
  > input[value]:not([value='']) + label {
    @extend %label-above-input;
  }

  // If no placeholder and no value => always above
  // Place an empty placeholder (<input placeholder="">) to get the label inside the input
  > input:not([placeholder]):not([value]) + label {
    @extend %label-above-input;
  }
}

%label-inside-input {
  // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_variables.scss#L410
  top: calc(#{$input-padding-y} + #{$input-border-width});
  left: calc(#{$input-padding-x} + #{$input-border-width});
}

%label-above-input {
  top: $label-top-position;

  // Hack to hide the input border under the label
  background-color: $input-bg;
  // ch = width of the character "0", see https://developer.mozilla.org/en-US/docs/Web/CSS/length#Units
  padding-left: 1ch;
  padding-right: 1ch;

  // Compensate 1ch padding-left
  left: calc(#{$input-padding-x} + #{$input-border-width} - 1ch);

  // Make the label smaller like in Material Design
  // See https://github.com/mui-org/material-ui/blob/v3.0.1/packages/material-ui/src/InputLabel/InputLabel.js#L29
  transform: scale($floating-label-scale);
  transform-origin: top left;
}
