/**
 * Other implementations:
 * - https://www.jquery-az.com/boots/demo.php?ex=52.0_3
 * - https://www.primefaces.org/primereact/#/inputtext
 * - https://getbootstrap.com/docs/4.1/examples/floating-labels/
 * - https://github.com/tonystar/bootstrap-float-label
 * - https://lusaxweb.github.io/vuesax/components/input.html#label-placeholder
 *   https://github.com/lusaxweb/vuesax/blob/master/src/components/vsInput/main.styl
 */

// calc(move label at the top of the input - middle of the label text height)
// See $input-height-inner and $input-height https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_variables.scss#L445-L446
//
// Why not include the font descent (distance between the font baseline and its bounding box bottom)?
// Problem: it differs from one font to another and cannot be computed in CSS
// See [TrueType fundamentals](https://docs.microsoft.com/en-us/typography/opentype/spec/ttch01)
// See [Meaning of top, ascent, baseline, descent, bottom, and leading in Android's FontMetrics](https://stackoverflow.com/a/27631737/990356)
// prettier-ignore
$label-top-position: calc(
  #{- $font-size-base * $input-line-height} + #{$input-border-width}
  + #{$font-size-sm * $input-line-height * 1 / 2}
);

.form-group {
  position: relative;

  // Initial state: the label is inside the input
  > input + label,
  > textarea + label {
    // Breaks flexbox
    // "An absolutely-positioned child of a flex container does not participate in flex layout", see https://stackoverflow.com/a/41033582/990356
    position: absolute;

    // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_variables.scss#L241
    transition: $transition-base;

    @extend %label-inside-input;
  }

  // Initial state: hide the placeholder
  > input::placeholder,
  > textarea::placeholder {
    color: transparent;
    transition: color 0.15s linear; // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_variables.scss#L242
  }
  // Except if <label> is before <input> => not a floating label
  > label + input::placeholder,
  > label + textarea::placeholder {
    color: inherit;
  }

  // When the input is focused:
  > input:focus,
  > textarea:focus {
    // - show the placeholder
    &::placeholder {
      color: inherit;
    }

    // - move the label above the input
    + label {
      @extend %label-above-input;
    }
  }
}

%label-inside-input {
  top: 0;
  left: 0;

  // See https://github.com/twbs/bootstrap/blob/v4.1.3/scss/_variables.scss#L410
  padding: calc(#{$input-padding-y} + #{$input-border-width}) calc(#{$input-padding-x} + #{$input-border-width});

  // Truncate the text label if larger than the input
  width: 100%;
  @include text-truncate;
}

%label-above-input {
  // Hack to hide the input border under the label
  background-color: $input-bg;

  top: $label-top-position;

  // ch = width of the character "0", see https://developer.mozilla.org/en-US/docs/Web/CSS/length#Units
  padding: 0 .7ch 0 .7ch;

  // Compensate .7ch padding-left
  left: calc(#{$input-padding-x} + #{$input-border-width} - .7ch);

  width: initial;

  font-size: $font-size-sm;
}
